{% extends 'gestion_escolar/base.html' %}

{% block content %}
<div class="container-fluid">
    <h1 class="h3 mb-4 text-gray-800">{{ titulo }}</h1>

    <form method="post" novalidate>
        {% csrf_token %}
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Nombre del Rol</h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="{{ form.name.id_for_label }}" class="form-label">{{ form.name.label }}</label>
                    {{ form.name }}
                    {% if form.name.errors %}<div class="invalid-feedback d-block">{{ form.name.errors }}</div>{% endif %}
                </div>
            </div>
        </div>

        <div class="card shadow mb-4">
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Matriz de Permisos</h6>
                <div>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="check-all">Marcar Todo</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="uncheck-all">Desmarcar Todo</button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>MÃ³dulo</th>
                                <th class="text-center">Ver</th>
                                <th class="text-center">Agregar</th>
                                <th class="text-center">Modificar</th>
                                <th class="text-center">Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in permissions_matrix %}
                            <tr>
                                <td><strong>{{ item.model_name }}</strong></td>
                                
                                {% if item.type == 'crud' %}
                                    <td class="text-center">
                                        {% if item.view %}<input class="form-check-input" type="checkbox" name="permissions" value="{{ item.view.id }}" {% if item.view in form.permissions.initial %}checked{% endif %}>{% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if item.add %}<input class="form-check-input" type="checkbox" name="permissions" value="{{ item.add.id }}" {% if item.add in form.permissions.initial %}checked{% endif %}>{% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if item.change %}<input class="form-check-input" type="checkbox" name="permissions" value="{{ item.change.id }}" {% if item.change in form.permissions.initial %}checked{% endif %}>{% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if item.delete %}<input class="form-check-input" type="checkbox" name="permissions" value="{{ item.delete.id }}" {% if item.delete in form.permissions.initial %}checked{% endif %}>{% endif %}
                                    </td>
                                {% elif item.type == 'custom' %}
                                    <td class="text-center">
                                        {% if item.permission %}
                                            <input class="form-check-input" type="checkbox" name="permissions" value="{{ item.permission.id }}" {% if item.permission in form.permissions.initial %}checked{% endif %}>
                                        {% endif %}
                                    </td>
                                    <td colspan="3" class="table-light"></td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-success btn-lg">Guardar Rol</button>
        <a href="{% url 'role_list' %}" class="btn btn-secondary btn-lg">Cancelar</a>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#check-all').click(function() {
        $('input[type="checkbox"]').prop('checked', true);
    });
    $('#uncheck-all').click(function() {
        $('input[type="checkbox"]').prop('checked', false);
    });
});
</script>
{% endblock %}